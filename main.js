(()=>{"use strict";var e=document.querySelector(".popup__type-movie-details"),t=e.querySelector(".popup__image"),o=e.querySelector(".popup__title"),n=e.querySelector(".popup__release-year"),c=e.querySelector(".popup__ganer"),i=e.querySelector(".popup__runtime"),r=e.querySelector(".popup__url"),a=e.querySelector(".popup__description"),l=e.querySelector(".popup__close"),u=document.querySelector(".body"),s=document.querySelector(".popup__movie-similar"),p=e.querySelector(".popup__movie-url");function m(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",(function(t){"Escape"===t.key&&d(e)})),l.addEventListener("click",(function(){d(e)})),f.addEventListener("click",(function(){d(e)})),window.addEventListener("click",(function(t){t.target===e&&d(e)}))}function d(e){e.classList.remove("popup_is-opened"),u.classList.remove("stop-scrolling")}s.addEventListener("click",(function(t){t.preventDefault(),document.querySelector(".movies").innerHTML="",d(e);var o="".concat(q).concat(k,"/similars");fetch(o,{method:"GET",headers:{"X-API-KEY":"99116293-2534-4b37-b131-ce5f5c970a85","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(t){console.log(t),t.items.forEach((function(e){var t,o,n,c,i,r=(t=e,o=h.querySelector(".similarmovie").cloneNode(!0),n=o.querySelector(".similarmovie__cover"),c=o.querySelector(".similarmovie__cover--darkened"),i=o.querySelector(".similarmovie__title"),c.addEventListener("click",(function(){void 0===t.kinopoiskId?L("".concat(E).concat(t.filmId)):L("".concat(E).concat(t.kinopoiskId))})),n.src=t.posterUrlPreview,n.alt=t.nameRu,i.textContent=t.nameRu,o);document.querySelector(".movies").appendChild(r)})),d(e)})).catch((function(e){console.log("Ошибка при выполнении функции: "+e)}))})),p.addEventListener("click",(function(t){t.preventDefault();var o="".concat(C).concat(k,"/external_sources?page=1");fetch(o,{method:"GET",headers:{"X-API-KEY":"99116293-2534-4b37-b131-ce5f5c970a85","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(t){console.log(t),d(e),function(e){var t=e.items;_.textContent="";for(var o=0;o<t.length;o++){var n=t[o],c=n.logoUrl,i=n.platform,r=n.url;_.innerHTML+='\n      <div class="popup__movieurls-item">\n        <img class="popup__movieurls-item-img" src="'.concat(c,'">\n        <a class="popup__movieurls-item-url" target="_blank" href="').concat(r,'">').concat(i,"</a> \n      </div>\n    ")}}(t),u.classList.add("stop-scrolling"),m(v)})).catch((function(e){console.log("Ошибка при выполнении функции: "+e)}))}));var v=document.querySelector(".popup__type-urls"),f=v.querySelector(".popup__close"),_=document.querySelector(".popup__movieurls"),y=document.querySelector("#movie").content,h=document.querySelector("#similarmovie").content;function g(e){var t=y.querySelector(".movie").cloneNode(!0),o=t.querySelector(".movie__cover"),n=t.querySelector(".movie__cover--darkened"),c=t.querySelector(".movie__title"),i=t.querySelector(".movie__category"),r=t.querySelector(".movie__year"),a=t.querySelector(".movie__rating"),l=t.querySelector(".movie__rating"),u=t.querySelector(".movie__info");if(void 0===e.ratingKinopoisk){var s=u.querySelector(".movie__rating");s.parentNode.removeChild(s)}return S(e.ratingKinopoisk),n.addEventListener("click",(function(){void 0===e.kinopoiskId?L("".concat(E).concat(e.filmId)):L("".concat(E).concat(e.kinopoiskId))})),o.src=e.posterUrlPreview,o.alt=e.nameRu,c.textContent=e.nameRu,i.textContent=e.genres.map((function(e){return" ".concat(e.genre)})),r.textContent=e.year,a.textContent=e.ratingKinopoisk,l.classList.add("".concat(S(e.ratingKinopoisk))),t}function S(e){return e>7?"movie__rating_green":e>5?"movie__rating_orange":"movie__rating_red"}var k,q="https://kinopoiskapiunofficial.tech/api/v2.2/films/",E="https://kinopoiskapiunofficial.tech/api/v2.2/films/",C="https://kinopoiskapiunofficial.tech/api/v2.2/films/";function L(l){fetch(l,{method:"GET",headers:{"X-API-KEY":"99116293-2534-4b37-b131-ce5f5c970a85","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(l){var s;return k=l.kinopoiskId,s=l,t.src=s.posterUrlPreview,t.alt=s.nameRu,o.textContent='"'.concat(s.nameRu,'"    '),n.textContent=s.year,c.textContent="Жанр: ".concat(s.genres.map((function(e){return" ".concat(e.genre)}))),i.textContent="Продолжительность: ".concat(s.filmLength," минут"),r.href="".concat(s.webUrl),r.textContent="".concat(s.webUrl),a.textContent="Описание: ".concat(s.description),u.classList.add("stop-scrolling"),m(e),k})).catch((function(e){console.log("Ошибка при выполнении функции: "+e)}))}var b=document.querySelector("form"),T=b.querySelector(".header__search");fetch("https://kinopoiskapiunofficial.tech/api/v2.2/films/collections?type=TOP_250_MOVIES&page=1",{method:"GET",headers:{"X-API-KEY":"99116293-2534-4b37-b131-ce5f5c970a85","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){e.items.forEach((function(e){var t=g(e);document.querySelector(".movies").appendChild(t)}))})).catch((function(e){console.log("Ошибка при выполнении функции: "+e)})),b.addEventListener("submit",(function(e){e.preventDefault(),document.querySelector(".movies").innerHTML="";var t="".concat("https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword=").concat(T.value);T.value&&(fetch(t,{method:"GET",headers:{"X-API-KEY":"99116293-2534-4b37-b131-ce5f5c970a85","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log(e),e.films.forEach((function(e){var t=g(e);document.querySelector(".movies").appendChild(t)}))})).catch((function(e){console.log("Ошибка при выполнении функции: "+e)})),T.value="")}))})();